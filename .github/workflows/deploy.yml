name: Generate Styles tokens and copy
on:
# Runs on pushes targeting the default branch
  push:
    branches:
      - main

# Sets permissions of the GITHUB_TOKEN to allow deployment to GitHub Pages
permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  build_tokens:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Setup Node.js environment
        uses: actions/setup-node@v2.4.0
        with:
          node-version: '16' # Specify Node.js version
      - run: npm install
      - run: npm init -y && npm install
      - run: node build.mjs
      - uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: build tokens


  copy_tokens:
    runs-on: ubuntu-latest
    needs: build_tokens
    steps:
      - uses: actions/checkout@v2
      - uses: andstor/copycat-action@v3.2.4
        with:
          personal_token: ${{ secrets.GH_PAT }}
          src_branch: main
          src_path: output/.
          dst_owner: nyan-matt
          dst_repo_name: global-design-storybook
          dst_branch: design-tokens
          dst_path: sccs/.
          username: nyan-matt
          email: vasiliy.emelin@solera.com
          commit_message: "Copy CSS tokens"
