name: Generate Styles tokens and copy
on:
# Runs on pushes targeting the default branch
  push:
    branches:
      - main

# Sets permissions of the GITHUB_TOKEN to allow deployment to GitHub Pages
permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  build_tokens:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Setup Node.js environment
        uses: actions/setup-node@v2.4.0
        with:
          node-version: '18' # Update Node.js version
      - run: npm install
      - run: node build.mjs
      - uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: build tokens


  copy_tokens:
    runs-on: ubuntu-latest
    needs: build_tokens
    steps:
      - uses: actions/checkout@v2
      - uses: andstor/copycat-action@v3.2.4
        with:
          personal_token: ${{ secrets.DESIGN_TOKEN }}    # Ensure your PAT is valid and has the right permissions
          src_branch: main                         # Source branch in the current repository
          src_path: tokens/output/.                # Path in the source repository to copy files from
          dst_owner: vemelin                       # GitHub username (or organization name)
          dst_repo_name: celebration-cards         # Destination repository name
          dst_branch: design-tokens                # Branch in the destination repository
          dst_path: scss/.                         # Path in the destination repository
          username: vemelin                        # GitHub username (used for commits)
          email: vemelin@gmail.com                 # Commit email
          commit_message: "Copy CSS tokens"        # Custom commit message